"use strict";var UIColorPicker=function UIColorPicker(){var subscribers=[],pickers=[];function Color(color){color instanceof Color!=!0?(this.r=0,this.g=0,this.b=0,this.a=1,this.hue=0,this.saturation=0,this.value=0,this.lightness=0,this.format="HSV"):this.copy(color)}function RGBColor(r,g,b){var color=new Color;return color.setRGBA(r,g,b,1),color}function RGBAColor(r,g,b,a){var color=new Color;return color.setRGBA(r,g,b,a),color}function HSVColor(h,s,v){var color=new Color;return color.setHSV(h,s,v),color}function HSVAColor(h,s,v,a){var color=new Color;return color.setHSV(h,s,v),color.a=a,color}function HSLColor(h,s,l){var color=new Color;return color.setHSL(h,s,l),color}function HSLAColor(h,s,l,a){var color=new Color;return color.setHSL(h,s,l),color.a=a,color}Color.prototype.copy=function copy(obj){obj instanceof Color==!0?(this.r=obj.r,this.g=obj.g,this.b=obj.b,this.a=obj.a,this.hue=obj.hue,this.saturation=obj.saturation,this.value=obj.value,this.format=""+obj.format,this.lightness=obj.lightness):console.log("Typeof parameter not Color")},Color.prototype.setFormat=function setFormat(format){"HSV"===format&&(this.format="HSV"),"HSL"===format&&(this.format="HSL")},Color.prototype.isValidRGBValue=function isValidRGBValue(value){return"number"==typeof value&&!1===isNaN(value)&&value>=0&&value<=255},Color.prototype.setRGBA=function setRGBA(red,green,blue,alpha){!1!==this.isValidRGBValue(red)&&!1!==this.isValidRGBValue(green)&&!1!==this.isValidRGBValue(blue)&&(this.r=0|red,this.g=0|green,this.b=0|blue,!0===this.isValidRGBValue(alpha)&&(this.a=0|alpha))},Color.prototype.setByName=function setByName(name,value){if("r"===name||"g"===name||"b"===name){if(!1===this.isValidRGBValue(value))return;this[name]=value,this.updateHSX()}},Color.prototype.setHSV=function setHSV(hue,saturation,value){this.hue=hue,this.saturation=saturation,this.value=value,this.HSVtoRGB()},Color.prototype.setHSL=function setHSL(hue,saturation,lightness){this.hue=hue,this.saturation=saturation,this.lightness=lightness,this.HSLtoRGB()},Color.prototype.setHue=function setHue(value){"number"!=typeof value||!0===isNaN(value)||value<0||value>359||(this.hue=value,this.updateRGB())},Color.prototype.setSaturation=function setSaturation(value){"number"!=typeof value||!0===isNaN(value)||value<0||value>100||(this.saturation=value,this.updateRGB())},Color.prototype.setValue=function setValue(value){"number"!=typeof value||!0===isNaN(value)||value<0||value>100||(this.value=value,this.HSVtoRGB())},Color.prototype.setLightness=function setLightness(value){"number"!=typeof value||!0===isNaN(value)||value<0||value>100||(this.lightness=value,this.HSLtoRGB())},Color.prototype.setHexa=function setHexa(value){var valid;!0===/(^#{0,1}[0-9A-F]{6}$)|(^#{0,1}[0-9A-F]{3}$)/i.test(value)&&("#"===value[0]&&(value=value.slice(1,value.length)),3===value.length&&(value=value.replace(/([0-9A-F])([0-9A-F])([0-9A-F])/i,"$1$1$2$2$3$3")),this.r=parseInt(value.substr(0,2),16),this.g=parseInt(value.substr(2,2),16),this.b=parseInt(value.substr(4,2),16),this.alpha=1,this.RGBtoHSV())},Color.prototype.convertToHSL=function convertToHSL(){"HSL"!==this.format&&(this.setFormat("HSL"),this.RGBtoHSL())},Color.prototype.convertToHSV=function convertToHSV(){"HSV"!==this.format&&(this.setFormat("HSV"),this.RGBtoHSV())},Color.prototype.updateRGB=function updateRGB(){"HSV"!==this.format?"HSL"!==this.format||this.HSLtoRGB():this.HSVtoRGB()},Color.prototype.updateHSX=function updateHSX(){"HSV"!==this.format?"HSL"!==this.format||this.RGBtoHSL():this.RGBtoHSV()},Color.prototype.HSVtoRGB=function HSVtoRGB(){var sat=this.saturation/100,value=this.value/100,C=sat*value,H=this.hue/60,X=C*(1-Math.abs(H%2-1)),m=value-C,precision=255;C=255*(C+m)|0,X=255*(X+m)|0,m=255*m|0,H>=0&&H<1?this.setRGBA(C,X,m):H>=1&&H<2?this.setRGBA(X,C,m):H>=2&&H<3?this.setRGBA(m,C,X):H>=3&&H<4?this.setRGBA(m,X,C):H>=4&&H<5?this.setRGBA(X,m,C):H>=5&&H<6&&this.setRGBA(C,m,X)},Color.prototype.HSLtoRGB=function HSLtoRGB(){var sat=this.saturation/100,light=this.lightness/100,C=sat*(1-Math.abs(2*light-1)),H=this.hue/60,X=C*(1-Math.abs(H%2-1)),m=light-C/2,precision=255;C=255*(C+m)|0,X=255*(X+m)|0,m=255*m|0,H>=0&&H<1?this.setRGBA(C,X,m):H>=1&&H<2?this.setRGBA(X,C,m):H>=2&&H<3?this.setRGBA(m,C,X):H>=3&&H<4?this.setRGBA(m,X,C):H>=4&&H<5?this.setRGBA(X,m,C):H>=5&&H<6&&this.setRGBA(C,m,X)},Color.prototype.RGBtoHSV=function RGBtoHSV(){var red=this.r/255,green=this.g/255,blue=this.b/255,cmax=Math.max(red,green,blue),cmin,delta=cmax-Math.min(red,green,blue),hue=0,saturation=0;delta&&(cmax===red&&(hue=(green-blue)/delta),cmax===green&&(hue=2+(blue-red)/delta),cmax===blue&&(hue=4+(red-green)/delta),cmax&&(saturation=delta/cmax)),this.hue=60*hue|0,this.hue<0&&(this.hue+=360),this.saturation=100*saturation|0,this.value=100*cmax|0},Color.prototype.RGBtoHSL=function RGBtoHSL(){var red=this.r/255,green=this.g/255,blue=this.b/255,cmax=Math.max(red,green,blue),cmin=Math.min(red,green,blue),delta=cmax-cmin,hue=0,saturation=0,lightness=(cmax+cmin)/2,X=1-Math.abs(2*lightness-1);delta&&(cmax===red&&(hue=(green-blue)/delta),cmax===green&&(hue=2+(blue-red)/delta),cmax===blue&&(hue=4+(red-green)/delta),cmax&&(saturation=delta/X)),this.hue=60*hue|0,this.hue<0&&(this.hue+=360),this.saturation=100*saturation|0,this.lightness=100*lightness|0},Color.prototype.getHexa=function getHexa(){var r=this.r.toString(16),g=this.g.toString(16),b=this.b.toString(16),value;return this.r<16&&(r="0"+r),this.g<16&&(g="0"+g),this.b<16&&(b="0"+b),("#"+r+g+b).toUpperCase()},Color.prototype.getRGBA=function getRGBA(){var rgb="("+this.r+", "+this.g+", "+this.b,a="",v="",x=parseFloat(this.a),value;return 1!==x&&(a="a",v=", "+x),"rgb"+a+rgb+v+")"},Color.prototype.getHSLA=function getHSLA(){if("HSV"===this.format){var color=new Color(this);return color.setFormat("HSL"),color.updateHSX(),color.getHSLA()}var a="",v="",hsl="("+this.hue+", "+this.saturation+"%, "+this.lightness+"%",x=parseFloat(this.a),value;return 1!==x&&(a="a",v=", "+x),"hsl"+a+hsl+v+")"},Color.prototype.getColor=function getColor(){return!1|this.a?this.getHexa():this.getRGBA()};var setMouseTracking=function setMouseTracking(elem,callback){elem.addEventListener("mousedown",function(e){callback(e),document.addEventListener("mousemove",callback)}),document.addEventListener("mouseup",function(e){document.removeEventListener("mousemove",callback)})};function ColorPicker(node){this.color=new Color,this.node=node,this.subscribers=[];var type=this.node.getAttribute("data-mode"),topic=this.node.getAttribute("data-topic");this.topic=topic,this.picker_mode="HSL"===type?"HSL":"HSV",this.color.setFormat(this.picker_mode),this.manageColorPickerWindow(),this.openColorPicker(),this.setFromPresetColor(),this.setManualColor(),this.createPickingArea(),this.createHueArea(),this.createPreviewBox(),this.createChangeModeButton(),this.setColor(this.color),pickers[topic]=this}function isDescendant(parent,child){for(var node=child.parentNode;null!=node;){if(node==parent)return!0;node=node.parentNode}return!1}function is_element_in_viewport(el){"function"==typeof jQuery&&el instanceof jQuery&&(el=el[0]);let rect=el.getBoundingClientRect(),windowHeight=window.innerHeight||document.documentElement.clientHeight,windowWidth=window.innerWidth||document.documentElement.clientWidth;return rect.left>=0&&rect.top>=0&&rect.left+rect.width<=windowWidth&&rect.top+rect.height<=windowHeight}ColorPicker.prototype.manageColorPickerWindow=function manageColorPickerWindow(elem){let colorPickerElem=document.getElementById("picker-container");document.addEventListener("click",function(e){let parentIsColorPickerElem;isDescendant(colorPickerElem,e.target)||(e.target.classList.contains("ps_colorpicker")?colorPickerElem.style.display="block":colorPickerElem.style.display="none")})},ColorPicker.prototype.openColorPicker=function openColorPicker(elem){let color=this.color;window.onload=function(){let elems=[].slice.call(document.getElementsByClassName("ps_colorpicker")),colorPickerElem=document.getElementById("picker-container"),colorPickerElemComplete=document.getElementById("picker"),offset=5;elems.forEach(function(item,idx){item.addEventListener("click",function(event){let parentIsColorPickerElem;if(!isDescendant(colorPickerElem,event.target)){this.classList.add("preview-color"),this.appendChild(colorPickerElem),colorPickerElem.style.display="block";let itemHeight,itemPositionY=this.getBoundingClientRect().height+10,colorPickerElemIsFullVisible;colorPickerElem.style.top=itemPositionY+"px",is_element_in_viewport(colorPickerElemComplete)||(colorPickerElem.style.bottom=itemPositionY+"px",colorPickerElem.style.top="inherit");let hueSlider=item.getElementsByClassName("hue")[0],hueCircle=item.getElementsByClassName("slider-picker")[0],pickingArea=item.getElementsByClassName("picking-area")[0],pickerColor=item.getElementsByClassName("picker")[0],sColorHexa=item.getElementsByClassName("ps_colorpicker_input")[0].value,hueSliderWidth=hueSlider.clientWidth,sizeWidth=pickingArea.clientWidth,sizeHeight=pickingArea.clientHeight;color.setHexa(sColorHexa);let value=color.value,saturation=color.saturation;hueCircle.style.left=color.hue*hueSliderWidth/359+"px",hueCircle.style.backgroundColor=sColorHexa,color.setHSV(color.hue,100,100),pickingArea.style.backgroundColor=color.getRGBA();let x=saturation*sizeWidth/100|0,y=sizeHeight-value*sizeHeight/100|0;pickerColor.style.left=x-5+"px",pickerColor.style.top=y-5+"px"}})})}},ColorPicker.prototype.setManualColor=function setManualColor(elem){let inputColor=document.getElementsByClassName("input-user-presets-save")[0],saveButton=document.getElementById("save-user-color"),color=this.color;inputColor.addEventListener("input",function(event){let colorPickerElem,colorPickerElemParent=document.getElementById("picker-container").parentNode,inputColorElem=colorPickerElemParent.children[0],hueSlider=document.getElementsByClassName("hue")[0],hueCircle=document.getElementsByClassName("slider-picker")[0],pickingArea=document.getElementsByClassName("picking-area")[0],pickerColor=document.getElementsByClassName("picker")[0],hueSliderWidth=hueSlider.clientWidth,sizeWidth=pickingArea.clientWidth,sizeHeight=pickingArea.clientHeight,sColorHexa=this.value,sColorHexaLength=sColorHexa.length,lenghtOk=!1,isHexa=!1,regex;4!=sColorHexaLength&&7!=sColorHexaLength||(lenghtOk=!0),/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.exec(sColorHexa)&&(isHexa=!0),isHexa&&lenghtOk?(saveButton.classList.add("btn-colorpicker"),saveButton.classList.remove("btn-colorpicker-notgood"),colorPickerElemParent.style.backgroundColor=sColorHexa,inputColorElem.value=sColorHexa):(saveButton.classList.add("btn-colorpicker-notgood"),saveButton.classList.remove("btn-colorpicker"),colorPickerElemParent.style.backgroundColor="#FFF",inputColorElem.value="#FFF"),inputColorElem.dispatchEvent(new Event("ps_colorpicker_update",{bubbles:!0})),color.setHexa(sColorHexa);let value=color.value,saturation=color.saturation;hueCircle.style.left=color.hue*hueSliderWidth/359+"px",hueCircle.style.backgroundColor=sColorHexa,color.setHSV(color.hue,100,100),pickingArea.style.backgroundColor=color.getRGBA();let x=saturation*sizeWidth/100|0,y=sizeHeight-value*sizeHeight/100|0;pickerColor.style.left=x-5+"px",pickerColor.style.top=y-5+"px"})},ColorPicker.prototype.setFromPresetColor=function setPresetColor(elem){let color=this.color,elems;[].slice.call(document.getElementsByClassName("color-preset")).forEach(function(item,idx){item.addEventListener("click",function(event){let bgcolor=event.target.getAttribute("data-bgcolor"),inputColor=document.getElementsByClassName("input-user-presets-save")[0],colorPickerElem,colorPickerElemParent=document.getElementById("picker-container").parentNode,inputColorElem=colorPickerElemParent.children[0],saveButton=document.getElementById("save-user-color"),pickerColor=document.getElementsByClassName("picker")[0],pickingArea=document.getElementsByClassName("picking-area")[0],hueSlider=document.getElementsByClassName("hue")[0],hueCircle=document.getElementsByClassName("slider-picker")[0],hueSliderWidth=hueSlider.clientWidth,sizeWidth=pickingArea.clientWidth,sizeHeight=pickingArea.clientHeight;color.setHexa(bgcolor);let value=color.value,saturation=color.saturation;colorPickerElemParent.style.backgroundColor=bgcolor,inputColorElem.value=bgcolor,inputColorElem.dispatchEvent(new Event("ps_colorpicker_update",{bubbles:!0})),inputColor.value=bgcolor,saveButton.classList.add("btn-colorpicker"),saveButton.classList.remove("btn-colorpicker-notgood"),hueCircle.style.left=color.hue*hueSliderWidth/359+"px",hueCircle.style.backgroundColor=bgcolor,color.setHSV(color.hue,100,100),pickingArea.style.backgroundColor=color.getRGBA();let x=saturation*sizeWidth/100|0,y=sizeHeight-value*sizeHeight/100|0;pickerColor.style.left=x-5+"px",pickerColor.style.top=y-5+"px"})})},ColorPicker.prototype.createPickingArea=function createPickingArea(){var area=document.createElement("div"),picker=document.createElement("div");area.className="picking-area",picker.className="picker",this.picking_area=area,this.color_picker=picker,setMouseTracking(area,this.updateColor.bind(this)),area.appendChild(picker),this.node.appendChild(area)},ColorPicker.prototype.createHueArea=function createHueArea(){var area=document.createElement("div"),picker=document.createElement("div");area.className="hue",picker.className="slider-picker",this.hue_area=area,this.hue_picker=picker,setMouseTracking(area,this.updateHueSlider.bind(this)),area.appendChild(picker),this.node.appendChild(area)},ColorPicker.prototype.createPreviewBox=function createPreviewBox(e){var preview_box=document.createElement("div"),preview_color=document.createElement("div");preview_box.className="preview",preview_color.className="preview-color",this.preview_color=preview_color,preview_box.appendChild(preview_color),this.node.appendChild(preview_box)},ColorPicker.prototype.createChangeModeButton=function createChangeModeButton(){var button=document.createElement("div");button.className="switch_mode",button.addEventListener("click",function(){"HSV"===this.picker_mode?this.setPickerMode("HSL"):this.setPickerMode("HSV")}.bind(this)),this.node.appendChild(button)},ColorPicker.prototype.updateColor=function updateColor(e){let pickingArea=document.getElementsByClassName("picking-area")[0],offsetPage=20,PickingAreaElem=this.hue_area.getBoundingClientRect(),x=e.pageX-PickingAreaElem.x+20,y=e.clientY-pickingArea.getBoundingClientRect().top,picker_offset=5,size=this.picking_area.clientWidth,height=this.picking_area.clientHeight;x<0&&(x=0),y<0&&(y=0),x>size&&(x=size),y>height&&(y=height);let ycolor,value=100-100*(size*(y/height))/size|0,saturation=100*x/size|0;"HSV"===this.picker_mode&&this.color.setHSV(this.color.hue,saturation,value),"HSL"===this.picker_mode&&this.color.setHSL(this.color.hue,saturation,value),this.color_picker.style.left=x-5+"px",this.color_picker.style.top=y-5+"px",this.updatePreviewColor()},ColorPicker.prototype.updateHueSlider=function updateHueSlider(e){let HueAreaElem=this.hue_area.getBoundingClientRect(),circleOffset=3,x=e.pageX-HueAreaElem.x-3,width=this.hue_area.clientWidth;x<0&&(x=0),x>width&&(x=width);let hue=359*x/width|0;this.updateSliderPosition(this.hue_picker,x),this.setHue(hue)},ColorPicker.prototype.setHue=function setHue(value){this.color.setHue(value),this.updatePickerBackground(),this.updatePreviewColor()},ColorPicker.prototype.updateSLV=function updateSLV(){this.updatePickerPosition(),this.updatePreviewColor()},ColorPicker.prototype.updatePickerPosition=function updatePickerPosition(){var size=this.picking_area.clientWidth,value=0,offset=5;"HSV"===this.picker_mode&&(value=this.color.value),"HSL"===this.picker_mode&&(value=this.color.lightness);var x=this.color.saturation*size/100|0,y=size-value*size/100|0;this.color_picker.style.left=x-5+"px",this.color_picker.style.top=y-5+"px"},ColorPicker.prototype.updateSliderPosition=function updateSliderPosition(elem,pos){elem.style.left=Math.max(pos-3,-2)+"px"},ColorPicker.prototype.updateHuePicker=function updateHuePicker(){var size=this.hue_area.clientWidth,offset=1,pos=this.color.hue*size/360|0;this.hue_picker.style.left=pos-1+"px"},ColorPicker.prototype.updatePickerBackground=function updatePickerBackground(){var nc=new Color(this.color);nc.setHSV(nc.hue,100,100),this.picking_area.style.backgroundColor=nc.getHexa()},ColorPicker.prototype.updatePreviewColor=function updatePreviewColor(){let sliderPickerSelection=document.getElementsByClassName("slider-picker")[0],inputcolor=document.getElementsByClassName("input-user-presets-save")[0],saveButton=document.getElementById("save-user-color"),colorPickerElem,colorPickerElemParent=document.getElementById("picker-container").parentNode,inputColorElem=colorPickerElemParent.children[0];colorPickerElemParent.style.backgroundColor=this.color.getColor(),inputColorElem.value=this.color.getColor(),inputColorElem.dispatchEvent(new Event("ps_colorpicker_update",{bubbles:!0})),sliderPickerSelection.style.backgroundColor=this.color.getColor(),inputcolor.value=this.color.getHexa(),saveButton&&(saveButton.classList.add("btn-colorpicker"),saveButton.classList.remove("btn-colorpicker-notgood"))},ColorPicker.prototype.setColor=function setColor(color){color instanceof Color==!0?(color.format!==this.picker_mode&&(color.setFormat(this.picker_mode),color.updateHSX()),this.color.copy(color),this.updatePickerPosition(),this.updatePickerBackground(),this.updatePreviewColor()):console.log("Typeof parameter not Color")},ColorPicker.prototype.setPickerMode=function setPickerMode(mode){"HSV"!==mode&&"HSL"!==mode||(this.picker_mode=mode,this.node.setAttribute("data-mode",this.picker_mode),this.setColor(this.color))};var setPickerMode,setColor,getColor=function getColor(topic){if(pickers[topic])return new Color(pickers[topic].color)},init;return{init:function init(){for(var elem=document.querySelectorAll(".ui-color-picker"),size=elem.length,i=0;i<size;i++)new ColorPicker(elem[i])},Color:Color,RGBColor:RGBColor,RGBAColor:RGBAColor,HSVColor:HSVColor,HSVAColor:HSVAColor,HSLColor:HSLColor,HSLAColor:HSLAColor,setColor:function setColor(topic,color){pickers[topic]&&pickers[topic].setColor(color)},getColor:getColor,setPickerMode:function setPickerMode(topic,mode){pickers[topic]&&pickers[topic].setPickerMode(mode)}}}(),ColorPickerTool=function ColorPickerTool(){var Color=UIColorPicker.Color,HSLColor=UIColorPicker.HSLColor,StateButton=function StateButton(node,state){this.state=!1,this.callback=null,node.addEventListener("click",function(){this.state=!this.state,"function"==typeof this.callback&&this.callback(this.state)}.bind(this))},init;return StateButton.prototype.set=function set(){this.state=!0,"function"==typeof this.callback&&this.callback(this.state)},StateButton.prototype.unset=function unset(){this.state=!1,"function"==typeof this.callback&&this.callback(this.state)},{init:function init(){UIColorPicker.init()}}}();ColorPickerTool.init();